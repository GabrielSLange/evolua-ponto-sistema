# Guia de Contribui√ß√£o - Evolua Ponto Sistema

## üìã √çndice

- [Como Contribuir](#como-contribuir)
- [Configura√ß√£o do Ambiente](#configura√ß√£o-do-ambiente)
- [Padr√µes de C√≥digo](#padr√µes-de-c√≥digo)
- [Processo de Desenvolvimento](#processo-de-desenvolvimento)
- [Testes](#testes)
- [Documenta√ß√£o](#documenta√ß√£o)
- [Pull Requests](#pull-requests)
- [Issues](#issues)

## ü§ù Como Contribuir

Obrigado por considerar contribuir com o Evolua Ponto Sistema! Este guia ir√° ajud√°-lo a entender como contribuir de forma eficaz.

### Tipos de Contribui√ß√£o

- üêõ **Bug Fixes**: Corre√ß√£o de bugs existentes
- ‚ú® **Features**: Implementa√ß√£o de novas funcionalidades
- üìö **Documenta√ß√£o**: Melhoria da documenta√ß√£o
- üß™ **Testes**: Adi√ß√£o ou melhoria de testes
- üé® **UI/UX**: Melhorias na interface do usu√°rio
- ‚ö° **Performance**: Otimiza√ß√µes de performance
- üîí **Seguran√ßa**: Melhorias de seguran√ßa

## ‚öôÔ∏è Configura√ß√£o do Ambiente

### Pr√©-requisitos

- Node.js 18+
- .NET 8 SDK
- Docker e Docker Compose
- Git
- Editor de c√≥digo (VS Code recomendado)

### 1. Fork e Clone

```bash
# Fork o reposit√≥rio no GitHub
# Clone seu fork
git clone https://github.com/SEU-USUARIO/evolua-ponto-sistema.git
cd evolua-ponto-sistema

# Adicionar upstream
git remote add upstream https://github.com/ORIGINAL-REPO/evolua-ponto-sistema.git
```

### 2. Configura√ß√£o do Backend

```bash
cd backend/EvoluaPonto.Api/EvoluaPonto.Api

# Restaurar depend√™ncias
dotnet restore

# Configurar banco de dados
# Copiar appsettings.Development.json e configurar connection string
cp appsettings.json appsettings.Development.json

# Executar migra√ß√µes
dotnet ef database update
```

### 3. Configura√ß√£o do Frontend

```bash
cd frontend

# Instalar depend√™ncias
npm install

# Configurar vari√°veis de ambiente
cp .env.example .env
# Editar .env com suas configura√ß√µes
```

### 4. Configura√ß√£o com Docker

```bash
# Na raiz do projeto
cp .env.example .env
# Editar .env com suas configura√ß√µes

# Subir os servi√ßos
docker-compose -f docker-compose.dev.yml up -d
```

## üìù Padr√µes de C√≥digo

### Backend (.NET)

#### Conven√ß√µes de Nomenclatura

- **Classes**: PascalCase (`RegistroPontoService`)
- **M√©todos**: PascalCase (`RegistrarPontoAsync`)
- **Propriedades**: PascalCase (`FuncionarioId`)
- **Vari√°veis**: camelCase (`funcionarioId`)
- **Constantes**: PascalCase (`MAX_RETRY_ATTEMPTS`)

#### Estrutura de Arquivos

```
Controllers/
‚îú‚îÄ‚îÄ AuthController.cs
‚îú‚îÄ‚îÄ FuncionarioController.cs
‚îî‚îÄ‚îÄ RegistroPontoController.cs

Services/
‚îú‚îÄ‚îÄ FuncionarioService.cs
‚îú‚îÄ‚îÄ RegistroPontoService.cs
‚îî‚îÄ‚îÄ External/
    ‚îî‚îÄ‚îÄ SupabaseAdminService.cs

Models/
‚îú‚îÄ‚îÄ ModelFuncionario.cs
‚îú‚îÄ‚îÄ ModelEmpresa.cs
‚îî‚îÄ‚îÄ Shared/
    ‚îî‚îÄ‚îÄ ServiceResponse.cs
```

#### Exemplo de Controller

```csharp
[ApiController]
[Route("[controller]")]
public class FuncionarioController : ControllerBase
{
    private readonly FuncionarioService _funcionarioService;

    public FuncionarioController(FuncionarioService funcionarioService)
    {
        _funcionarioService = funcionarioService;
    }

    [HttpGet]
    public async Task<IActionResult> GetFuncionarios()
    {
        try
        {
            var funcionarios = await _funcionarioService.GetAllAsync();
            return Ok(funcionarios);
        }
        catch (Exception ex)
        {
            return StatusCode(500, new { message = "Erro interno do servidor", error = ex.Message });
        }
    }
}
```

#### Exemplo de Service

```csharp
public class FuncionarioService
{
    private readonly AppDbContext _context;

    public FuncionarioService(AppDbContext context)
    {
        _context = context;
    }

    public async Task<ServiceResponse<List<ModelFuncionario>>> GetAllAsync()
    {
        try
        {
            var funcionarios = await _context.Funcionarios
                .Include(f => f.Estabelecimento)
                .Where(f => f.Ativo)
                .ToListAsync();

            return new ServiceResponse<List<ModelFuncionario>> { Data = funcionarios };
        }
        catch (Exception ex)
        {
            return new ServiceResponse<List<ModelFuncionario>> 
            { 
                Success = false, 
                ErrorMessage = ex.Message 
            };
        }
    }
}
```

### Frontend (React Native/TypeScript)

#### Conven√ß√µes de Nomenclatura

- **Componentes**: PascalCase (`FuncionarioForm`)
- **Arquivos**: PascalCase (`FuncionarioForm.tsx`)
- **Hooks**: camelCase com prefixo `use` (`useFuncionario`)
- **Vari√°veis**: camelCase (`funcionarioId`)
- **Constantes**: UPPER_SNAKE_CASE (`API_BASE_URL`)

#### Estrutura de Componentes

```typescript
import React, { useState, useEffect } from 'react';
import { View, StyleSheet } from 'react-native';
import { Text, Button } from 'react-native-paper';

interface FuncionarioFormProps {
  initialData?: ModelFuncionario;
  onSubmit: (data: FuncionarioCreateDto) => Promise<void>;
  isLoading?: boolean;
}

const FuncionarioForm: React.FC<FuncionarioFormProps> = ({
  initialData,
  onSubmit,
  isLoading = false
}) => {
  const [formData, setFormData] = useState<FuncionarioCreateDto>({
    nome: initialData?.nome || '',
    cpf: initialData?.cpf || '',
    // ... outros campos
  });

  const handleSubmit = async () => {
    try {
      await onSubmit(formData);
    } catch (error) {
      console.error('Erro ao salvar funcion√°rio:', error);
    }
  };

  return (
    <View style={styles.container}>
      <Text variant="headlineSmall">Dados do Funcion√°rio</Text>
      {/* Formul√°rio */}
      <Button 
        mode="contained" 
        onPress={handleSubmit}
        loading={isLoading}
      >
        Salvar
      </Button>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 16,
  },
});

export default FuncionarioForm;
```

#### Exemplo de Hook

```typescript
import { useState, useEffect } from 'react';
import api from '../services/api';

interface UseFuncionarioReturn {
  funcionarios: ModelFuncionario[];
  loading: boolean;
  error: string | null;
  createFuncionario: (data: FuncionarioCreateDto) => Promise<void>;
  updateFuncionario: (id: string, data: FuncionarioCreateDto) => Promise<void>;
  deleteFuncionario: (id: string) => Promise<void>;
}

export const useFuncionario = (estabelecimentoId?: string): UseFuncionarioReturn => {
  const [funcionarios, setFuncionarios] = useState<ModelFuncionario[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetchFuncionarios = async () => {
    setLoading(true);
    try {
      const response = await api.get('/funcionario', {
        params: { estabelecimentoId }
      });
      setFuncionarios(response.data);
    } catch (err) {
      setError('Erro ao carregar funcion√°rios');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchFuncionarios();
  }, [estabelecimentoId]);

  return {
    funcionarios,
    loading,
    error,
    createFuncionario: async (data) => {
      await api.post('/funcionario', data);
      await fetchFuncionarios();
    },
    updateFuncionario: async (id, data) => {
      await api.put(`/funcionario/${id}`, data);
      await fetchFuncionarios();
    },
    deleteFuncionario: async (id) => {
      await api.delete(`/funcionario/${id}`);
      await fetchFuncionarios();
    }
  };
};
```

## üîÑ Processo de Desenvolvimento

### 1. Criar Branch

```bash
# Atualizar main
git checkout main
git pull upstream main

# Criar nova branch
git checkout -b feature/nova-funcionalidade
# ou
git checkout -b fix/correcao-bug
```

### 2. Desenvolvimento

```bash
# Fazer commits frequentes
git add .
git commit -m "feat: adicionar valida√ß√£o de CPF"

# Push para seu fork
git push origin feature/nova-funcionalidade
```

### 3. Conven√ß√µes de Commit

Seguimos o padr√£o [Conventional Commits](https://www.conventionalcommits.org/):

```
tipo(escopo): descri√ß√£o

Corpo do commit (opcional)

Rodap√© (opcional)
```

**Tipos:**

- `feat`: Nova funcionalidade
- `fix`: Corre√ß√£o de bug
- `docs`: Documenta√ß√£o
- `style`: Formata√ß√£o, sem mudan√ßa de c√≥digo
- `refactor`: Refatora√ß√£o de c√≥digo
- `test`: Adi√ß√£o de testes
- `chore`: Tarefas de manuten√ß√£o

**Exemplos:**

```bash
git commit -m "feat(auth): adicionar refresh token autom√°tico"
git commit -m "fix(ponto): corrigir valida√ß√£o de hor√°rio"
git commit -m "docs(api): atualizar documenta√ß√£o dos endpoints"
git commit -m "refactor(services): extrair l√≥gica de valida√ß√£o"
```

## üß™ Testes

### Backend

```bash
# Executar todos os testes
dotnet test

# Executar testes com cobertura
dotnet test --collect:"XPlat Code Coverage"

# Executar testes espec√≠ficos
dotnet test --filter "ClassName=FuncionarioServiceTest"
```

### Frontend

```bash
# Executar testes
npm test

# Executar testes em modo watch
npm run test:watch

# Executar testes com cobertura
npm run test:coverage
```

### Testes de Integra√ß√£o

```bash
# Com Docker
docker-compose -f docker-compose.test.yml up --abort-on-container-exit
```

## üìö Documenta√ß√£o

### Atualizar Documenta√ß√£o

- **README.md**: Atualizar para mudan√ßas significativas
- **API Documentation**: Atualizar para novos endpoints
- **Frontend Documentation**: Atualizar para novos componentes
- **Database Schema**: Atualizar para mudan√ßas no banco

### Coment√°rios no C√≥digo

```csharp
/// <summary>
/// Registra um ponto para o funcion√°rio especificado
/// </summary>
/// <param name="pontoDto">Dados do registro de ponto</param>
/// <param name="funcionarioId">ID do funcion√°rio</param>
/// <returns>Resposta do servi√ßo com o registro criado</returns>
public async Task<ServiceResponse<ModelRegistroPonto>> RegistrarPontoAsync(
    RegistroPontoDto pontoDto, 
    Guid funcionarioId)
{
    // Implementa√ß√£o...
}
```

```typescript
/**
 * Hook para gerenciar funcion√°rios de um estabelecimento
 * @param estabelecimentoId - ID do estabelecimento (opcional)
 * @returns Objeto com estado e fun√ß√µes para gerenciar funcion√°rios
 */
export const useFuncionario = (estabelecimentoId?: string): UseFuncionarioReturn => {
  // Implementa√ß√£o...
};
```

## üîÄ Pull Requests

### Antes de Criar um PR

1. ‚úÖ C√≥digo segue os padr√µes estabelecidos
2. ‚úÖ Testes passam
3. ‚úÖ Documenta√ß√£o atualizada
4. ‚úÖ Commits seguem conven√ß√µes
5. ‚úÖ Branch atualizada com main

### Template de PR

```markdown
## Descri√ß√£o
Breve descri√ß√£o das mudan√ßas realizadas.

## Tipo de Mudan√ßa
- [ ] Bug fix
- [ ] Nova funcionalidade
- [ ] Breaking change
- [ ] Documenta√ß√£o

## Checklist
- [ ] C√≥digo testado
- [ ] Documenta√ß√£o atualizada
- [ ] Testes adicionados/atualizados
- [ ] N√£o h√° breaking changes

## Screenshots (se aplic√°vel)
Adicionar screenshots para mudan√ßas de UI.

## Issues Relacionadas
Closes #123
```

### Processo de Review

1. **Autom√°tico**: CI/CD executa testes
2. **Review**: Pelo menos 1 aprova√ß√£o necess√°ria
3. **Merge**: Ap√≥s aprova√ß√£o e testes passando

## üêõ Issues

### Criando Issues

Use os templates dispon√≠veis:

- üêõ **Bug Report**
- ‚ú® **Feature Request**
- üìö **Documentation**
- ‚ùì **Question**

### Labels

- `bug`: Algo n√£o est√° funcionando
- `enhancement`: Nova funcionalidade
- `documentation`: Melhorias na documenta√ß√£o
- `good first issue`: Bom para iniciantes
- `help wanted`: Precisa de ajuda
- `priority: high`: Alta prioridade
- `priority: medium`: M√©dia prioridade
- `priority: low`: Baixa prioridade

## üè∑Ô∏è Versionamento

Seguimos [Semantic Versioning](https://semver.org/):

- **MAJOR**: Mudan√ßas incompat√≠veis
- **MINOR**: Nova funcionalidade compat√≠vel
- **PATCH**: Corre√ß√µes compat√≠veis

## üìû Suporte

### Canais de Comunica√ß√£o

- üí¨ **Discord**: [Link do servidor]
- üìß **Email**: <dev@evolua.com>
- üìã **Issues**: GitHub Issues
- üìñ **Wiki**: [Link da wiki]

### Perguntas Frequentes

**Q: Como posso come√ßar a contribuir?**
A: Comece com issues marcadas como `good first issue` ou `help wanted`.

**Q: Preciso de permiss√£o para contribuir?**
A: N√£o! Qualquer um pode contribuir. Fork, fa√ßa suas mudan√ßas e abra um PR.

**Q: Como reportar um bug?**
A: Use o template de Bug Report nas Issues, incluindo passos para reproduzir.

**Q: Posso trabalhar em features grandes?**
A: Sim! Mas recomenda-se discutir primeiro em uma Issue para alinhar expectativas.

---

Obrigado por contribuir com o Evolua Ponto Sistema! üöÄ
